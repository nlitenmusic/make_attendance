<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Attendance - {{ filename }}</title>
<style>
body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding:20px; background:#fafafa; color:#222; }
table { width:100%; border-collapse:collapse; background:white; }
th, td { border:1px solid #ddd; padding:.5rem; text-align:left; }
th { background:#f5f5f5; }
input[type="text"] { width:100%; border:none; padding:.25rem; box-sizing:border-box; }
.btn { padding:.5rem .75rem; border-radius:6px; border:none; cursor:pointer; }
.add { background:#2ecc71; color:white; }
.save { background:#007bff; color:white; }
.del { background:#ff4b4b; color:white; }
.row-actions { display:flex; gap:.5rem; }
</style>
</head>
<body>
<a href="{{ url_for('index') }}"><button class="btn">‚¨Ö Back</button></a>
<h1>{{ filename.replace('.csv','') }}</h1>

<form method="post" action="{{ url_for('save_attendance') }}">
  <input type="hidden" name="filename" value="{{ filename }}">

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Age</th>
        <th>Member Name</th>

        {% for col in dynamic_dates %}
          <th>{{ col }}</th>
        {% endfor %}

        <th>Comments</th>
        <th>Fee</th>
        <th>Delete</th>
      </tr>
    </thead>

    <tbody id="rows">
      {% for row in data %}
      <tr>
        <td><input type="text" name="player_name" value="{{ row['Name'] }}"></td>
        <td><input type="text" name="age" value="{{ row['Age'] }}"></td>
        <td><input type="text" name="parent" value="{{ row['MemberName'] }}"></td>

        {% for col in dynamic_dates %}
          <td><input type="text" name="date__{{ col }}" value="{{ row[col] }}"></td>
        {% endfor %}

        <td><input type="text" name="comments" value="{{ row['Comments'] }}"></td>
        <td><input type="text" name="fee" value="{{ row['Fee'] }}"></td>

        <td>
          <input type="hidden" name="row_id" value="{{ row['row_id'] }}">
          <input type="hidden" name="delete_flag" value="">
          <button type="button" class="del" onclick="markDelete(this)">üóëÔ∏è</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

<div style="margin-top:1rem;">
  <form method="post" action="{{ url_for('add_row') }}" style="display:inline;">
    <input type="hidden" name="filename" value="{{ filename }}">
    <button class="add btn">+ Add Row</button>
  </form>  

  <div style="margin-top:1rem;">
    <button type="submit" class="save btn">Save Attendance</button>
  </div>
</form>

  <form method="post" action="{{ url_for('add_date_column') }}" style="display:inline; margin-left:1rem;">
    <input type="hidden" name="filename" value="{{ filename }}">
    <input type="text" name="new_date" placeholder="New date header (e.g. 1/10)" required>
    <button class="add btn">+ Add Date Column</button>
  </form>
</div>

<script>
function markDelete(btn){
  const delHidden = btn.parentElement.querySelector('input[name="delete_flag"]');
  delHidden.value = "1";
  btn.closest('tr').style.opacity = 0.5;
}
</script>

</body>
</html>
